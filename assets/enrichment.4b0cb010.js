(()=>{(function(){"use strict";var sn=function(){return function(n){n=n||{};var n=typeof n!="undefined"?n:{},s,i;n.ready=new Promise(function(e,t){s=e,i=t});var r={},o;for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);var c=!0,a="",b;typeof document!="undefined"&&document.currentScript&&(a=document.currentScript.src),a.indexOf("blob:")!==0?a=a.substr(0,a.lastIndexOf("/")+1):a="";var p=n.print||console.log.bind(console),y=n.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);r=null,n.arguments,n.thisProgram,n.quit;var m;n.wasmBinary&&(m=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&V("no native wasm support detected");var E,_=!1;function O(e,t){e||V("Assertion failed: "+t)}function d(e){var t=n["_"+e];return O(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function q(e,t,f,v,w){var h={string:function(R){var S=0;if(R!=null&&R!==0){var an=(R.length<<2)+1;S=$(an),bn(R,S,an)}return S},array:function(R){var S=$(R.length);return gn(R,S),S}};function l(R){return t==="string"?Y(R):t==="boolean"?Boolean(R):R}var u=d(e),g=[],I=0;if(v)for(var P=0;P<v.length;P++){var rn=h[f[P]];rn?(I===0&&(I=en()),g[P]=rn(v[P])):g[P]=v[P]}var B=u.apply(null,g);return B=l(B),I!==0&&tn(I),B}function hn(e,t,f,v){f=f||[];var w=f.every(function(l){return l==="number"}),h=t!=="string";return h&&w&&!v?d(e):function(){return q(e,t,f,arguments)}}var G=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;function X(e,t,f){for(var v=t+f,w=t;e[w]&&!(w>=v);)++w;if(w-t>16&&e.subarray&&G)return G.decode(e.subarray(t,w));for(var h="";t<w;){var l=e[t++];if(!(l&128)){h+=String.fromCharCode(l);continue}var u=e[t++]&63;if((l&224)==192){h+=String.fromCharCode((l&31)<<6|u);continue}var g=e[t++]&63;if((l&240)==224?l=(l&15)<<12|u<<6|g:l=(l&7)<<18|u<<12|g<<6|e[t++]&63,l<65536)h+=String.fromCharCode(l);else{var I=l-65536;h+=String.fromCharCode(55296|I>>10,56320|I&1023)}}return h}function Y(e,t){return e?X(x,e,t):""}function yn(e,t,f,v){if(!(v>0))return 0;for(var w=f,h=f+v-1,l=0;l<e.length;++l){var u=e.charCodeAt(l);if(u>=55296&&u<=57343){var g=e.charCodeAt(++l);u=65536+((u&1023)<<10)|g&1023}if(u<=127){if(f>=h)break;t[f++]=u}else if(u<=2047){if(f+1>=h)break;t[f++]=192|u>>6,t[f++]=128|u&63}else if(u<=65535){if(f+2>=h)break;t[f++]=224|u>>12,t[f++]=128|u>>6&63,t[f++]=128|u&63}else{if(f+3>=h)break;t[f++]=240|u>>18,t[f++]=128|u>>12&63,t[f++]=128|u>>6&63,t[f++]=128|u&63}}return t[f]=0,f-w}function bn(e,t,f){return yn(e,x,t,f)}typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");function gn(e,t){J.set(e,t)}var J,x,F;function vn(e){n.HEAP8=J=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=F=new Int32Array(e),n.HEAPU8=x=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}n.INITIAL_MEMORY;var k,K=[],Q=[],Z=[];function wn(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Tn(n.preRun.shift());U(K)}function En(){U(Q)}function Rn(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)An(n.postRun.shift());U(Z)}function Tn(e){K.unshift(e)}function _n(e){Q.unshift(e)}function An(e){Z.unshift(e)}var A=0,C=null;function In(e){A++,n.monitorRunDependencies&&n.monitorRunDependencies(A)}function Pn(e){if(A--,n.monitorRunDependencies&&n.monitorRunDependencies(A),A==0&&C){var t=C;C=null,t()}}n.preloadedImages={},n.preloadedAudios={};function V(e){n.onAbort&&n.onAbort(e),e+="",y(e),_=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}var dn="data:application/octet-stream;base64,";function Sn(e){return e.startsWith(dn)}var T;({VITE_APP_TITLE:"GXP",VITE_PRELOAD_DATA:"",VITE_PRELOAD_INFO:"",VITE_PRELOAD_IMAGE:"",VITE_PRELOAD_SETTINGS:"",VITE_PRELOAD_PLOTS:"",VITE_PRELOAD_ENRICHMENTS:"",BASE_URL:"/GeneExpressionPlots/",MODE:"production",DEV:!1,PROD:!0}===void 0)?T="/public/gsl.wasm":T="/GeneExpressionPlots/gsl.wasm";function M(e){try{if(e==T&&m)return new Uint8Array(m);if(!b)throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function On(){return!m&&c&&typeof fetch=="function"?fetch(T,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+T+"'";return e.arrayBuffer()}).catch(function(){return M(T)}):Promise.resolve().then(function(){return M(T)})}function xn(){var e={env:nn,wasi_snapshot_preview1:nn};function t(l,u){var g=l.exports;n.asm=g,E=n.asm.memory,vn(E.buffer),k=n.asm.__indirect_function_table,_n(n.asm.__wasm_call_ctors),Pn()}In();function f(l){t(l.instance)}function v(l){return On().then(function(u){var g=WebAssembly.instantiate(u,e);return g}).then(l,function(u){y("failed to asynchronously prepare wasm: "+u),V(u)})}function w(){return!m&&typeof WebAssembly.instantiateStreaming=="function"&&!Sn(T)&&typeof fetch=="function"?fetch(T,{credentials:"same-origin"}).then(function(l){var u=WebAssembly.instantiateStreaming(l,e);return u.then(f,function(g){return y("wasm streaming compile failed: "+g),y("falling back to ArrayBuffer instantiation"),v(f)})}):v(f)}if(n.instantiateWasm)try{var h=n.instantiateWasm(e,t);return h}catch(l){return y("Module.instantiateWasm callback failed with error: "+l),!1}return w().catch(i),{}}function U(e){for(;e.length>0;){var t=e.shift();if(typeof t=="function"){t(n);continue}var f=t.func;typeof f=="number"?t.arg===void 0?k.get(f)():k.get(f)(t.arg):f(t.arg===void 0?null:t.arg)}}function Fn(){V()}function Cn(e,t,f){x.copyWithin(e,t,t+f)}var D={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var f=D.buffers[e];t===0||t===10?((e===1?p:y)(X(f,0)),f.length=0):f.push(t)},varargs:void 0,get:function(){D.varargs+=4;var e=F[D.varargs-4>>2];return e},getStr:function(e){var t=Y(e);return t},get64:function(e,t){return e}};function Vn(e){return 0}function jn(e,t,f,v,w){}function Dn(e,t,f,v){for(var w=0,h=0;h<f;h++){for(var l=F[t+h*8>>2],u=F[t+(h*8+4)>>2],g=0;g<u;g++)D.printChar(e,x[l+g]);w+=u}return F[v>>2]=w,0}function Nn(e){}var nn={abort:Fn,emscripten_memcpy_big:Cn,fd_close:Vn,fd_seek:jn,fd_write:Dn,setTempRet0:Nn};xn(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._gsl_ran_hypergeometric_pdf=function(){return(n._gsl_ran_hypergeometric_pdf=n.asm.gsl_ran_hypergeometric_pdf).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.__errno_location).apply(null,arguments)};var en=n.stackSave=function(){return(en=n.stackSave=n.asm.stackSave).apply(null,arguments)},tn=n.stackRestore=function(){return(tn=n.stackRestore=n.asm.stackRestore).apply(null,arguments)},$=n.stackAlloc=function(){return($=n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)};n.dynCall_jiji=function(){return(n.dynCall_jiji=n.asm.dynCall_jiji).apply(null,arguments)},n.ccall=q,n.cwrap=hn;var N;C=function e(){N||z(),N||(C=e)};function z(e){if(A>0||(wn(),A>0))return;function t(){N||(N=!0,n.calledRun=!0,!_&&(En(),s(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),Rn()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()}if(n.run=z,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return z(),n.ready}}();const cn=sn();function H(n,s,i,r,o){const c=[n+o,s-o,i-o,r+o];if(c.findIndex(a=>a<0)===-1)return c}function L(n,s,i,r){return cn.then(o=>o._gsl_ran_hypergeometric_pdf(n,n+s,i+r,n+i))}async function fn(n,s,i,r){const o=[n,s,i,r];if(o.findIndex(m=>m<0)!==-1)throw new Error("Negative numbers are not supported.");if(o.findIndex(m=>!Number.isInteger(m))!==-1)throw new Error("Only positive integers are supported.");let c=0,a=[n,s,i,r];do{const m=await L(a[0],a[1],a[2],a[3]);if(m===0)break;c+=m,a=H(a[0],a[1],a[2],a[3],-1)}while(a!==void 0);let b=0;a=[n,s,i,r];do{const m=await L(a[0],a[1],a[2],a[3]);if(m===0)break;b+=m,a=H(a[0],a[1],a[2],a[3],1)}while(a!==void 0);const p=Math.min(c,b),y=Math.min(p*2,1);return{leftPValue:c,rightPValue:b,oneTailedPValue:p,twoTailedPValue:y}}function on(n){const s=n.length,i=n.map((c,a)=>[c,a]);i.sort((c,a)=>c[0]-a[0]);const r=n.slice();let o=Number.MAX_VALUE;for(let c=s-1;c>=0;c--){const[a,b]=i[c],p=Math.min(a*s/(c+1),1);p<o&&(o=p),r[b]=p,c<s-1&&r[b]>o&&(r[b]=o)}return r}function j(n,s){if(n.constructor.name!=="Set"||s.constructor.name!=="Set")throw Error(`Arguments must be of class 'Set', but a is an ${n.constructor.name} and b is an ${s.constructor.name}`);const i=[...n];return new Set(i.filter(r=>s.has(r)))}function W(n,s,i,r,o){const c=[j(n,i).size,j(s,i).size,j(r,n).size,j(r,s).size];if(o){const a=[],b=c.reduce((O,d)=>O+d),p=new Set([...n,...s,...i,...r]).size;b!==p&&a.push(`Contingency table sums up to ${b}, but universe has (arguments union to a set of) ${p} elements. This number must be identical.`);const y=c[0]+c[2];y!==n.size&&a.push(`${n.size} elements have trait 'A', but contingency table's first column sums to ${y}. Numbers must be equal.`);const m=c[0]+c[1];m!==n.size&&a.push(`${n.size} elements have trait 'B', but contingency table's first row sums to ${m}. Numbers must be equal.`);const E=c[1]+c[3];E!==s.size&&a.push(`${s.size} elements have trait 'A', but contingency table's second column sums to ${E}. Numbers must be equal.`);const _=c[2]+c[3];if(_!==s.size&&a.push(`${s.size} elements have trait 'B', but contingency table's second row sums to ${_}. Numbers must be equal.`),a.length>0)throw Error(a.join(" "))}return c}function un(n,s){switch(n){case"<":return i=>Object.entries(i).filter(r=>parseFloat(r[1])<parseFloat(s)).map(r=>r[0]);case">":return i=>Object.entries(i).filter(r=>parseFloat(r[1])>parseFloat(s)).map(r=>r[0]);case"<=":return i=>Object.entries(i).filter(r=>parseFloat(r[1])<=parseFloat(s)).map(r=>r[0]);case">=":return i=>Object.entries(i).filter(r=>Math.abs(parseFloat(r[1]))>=Math.abs(parseFloat(s))).map(r=>r[0]);case"abs >=":return i=>Object.entries(i).filter(r=>Math.abs(parseFloat(r[1]))>=Math.abs(parseFloat(s))).map(r=>r[0]);case"abs <=":return i=>Object.entries(i).filter(r=>Math.abs(parseFloat(r[1]))<=Math.abs(parseFloat(s))).map(r=>r[0]);case"abs >":return i=>Object.entries(i).filter(r=>Math.abs(parseFloat(r[1]))>Math.abs(parseFloat(s))).map(r=>r[0]);case"abs <":return i=>Object.entries(i).filter(r=>Math.abs(parseFloat(r[1]))<Math.abs(parseFloat(s))).map(r=>r[0]);case"==":return i=>Object.entries(i).filter(r=>r[1]==s).map(r=>r[0]);case"regexp":return i=>Object.entries(i).filter(r=>{const o=new RegExp(s);return!!r[1].match(o)}).map(r=>r[0]);default:throw new Error(`unsupported selector ${n}`)}}async function ln(n){return await fn(n[0],n[1],n[2],n[3])}async function mn(n,s){const i=[],r=[];return await Promise.all(Object.entries(n).map(async([c,a])=>{if(c&&c!==""&&c!=="NA"){const p=(await ln(a)).rightPValue;r.push(p);const y=s?[c,s[c],p]:[c,p];i.push(y)}})),on(r).forEach((c,a)=>{i[a].push(c)}),i}function pn(n,s,i,r,o){switch(o.TEIselectorType){case"binary":{const c=un(o.TEIselector,o.TEIselectorValue),a=new Set(c(r)),b=new Set(n.filter(m=>!a.has(m))),p=`${o.TEIcolumn} ${o.TEIselector} ${o.TEIselectorValue}`,y=W(s,i,a,b);return{[p]:y}}case"multinomial":{const c={};let a=[];return Object.entries(r).forEach(([p,y])=>{var m;if(o.TEIselector==="delimiter")a=y.split(o.TEIselectorValue);else if(o.TEFselector==="regexp"){const E=new RegExp(o.TEIselectorValue,"g");a=(m=y.match(E))!=null?m:[]}a&&a.forEach(E=>{Array.isArray(c[E])?c[E].push(p):c[E]=[p]})}),Object.entries(c).reduce((p,[y,m])=>{if(m.some(E=>s.has(E))){const E=new Set(m),_=new Set(n.filter(d=>!E.has(d))),O=W(s,i,E,_);p[y]=O}return p},{})}default:throw new Error(`unsupported selector type ${o.TEIselectorType}`)}}onmessage=async function(n){const{geneIdsTEFpos:s,geneIdsTEFneg:i,TEIpayload:r,TEIdescriptions:o,options:c}=n.data,a=[...s,...i],b=pn(a,s,i,r,c),p=await mn(b,o);postMessage(p.sort(),void 0)}})();})();
